<!DOCTYPE html>
<!-- 
--TODO YUYA KOMICHI--
・確認メール送る
・確認メール押したら仮登録フラグtrueにする
 -->

<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hibi wellbeing 新規登録</title>

    <!-- 目アイコン） -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- パスワード表示切替スクリプト -->
    <script>
      $(document).ready(function () {
        let overIcon = false; // アイコンにマウスが乗っているかを管理

        // 入力欄にフォーカスしたらアイコン表示
        $(".pass_box input").on("focus", function () {
          $(this).siblings("i").fadeIn(150);
        });

        // フォーカスが外れた時（マウスがアイコンに乗っていなければ非表示）
        $(".pass_box input").on("blur", function () {
          const icon = $(this).siblings("i");
          if (!overIcon) {
            // 表示中状態なら残す
            if (!icon.hasClass("fa-eye-slash")) {
              icon.fadeOut(150);
            }
          }
        });

        // アイコンにマウスが乗った／離れた
        $(".pass_box i")
          .on("mouseenter", function () {
            overIcon = true;
          })
          .on("mouseleave", function () {
            overIcon = false;
            const input = $(this).siblings("input");
            // フォーカスも外れていて、非表示状態なら消す
            if (!input.is(":focus") && !$(this).hasClass("fa-eye-slash")) {
              $(this).fadeOut(150);
            }
          });

        // パスワード 目 クリックで表示／非表示切り替え
        $(".pass_box i").on("click", function () {
          const input = $(this).siblings("input");
          if ($(this).hasClass("fa-eye")) {
            // 表示状態にする
            $(this).removeClass("fa-eye").addClass("fa-eye-slash");
            input.attr("type", "text");
          } else {
            // 非表示状態に戻す
            $(this).removeClass("fa-eye-slash").addClass("fa-eye");
            input.attr("type", "password");
            // もしフォーカスもマウスもないならアイコンを消す
            if (!input.is(":focus") && !overIcon) {
              $(this).fadeOut(150);
            }
          }
        });
      });
    </script>
  </head>

  <body>
    <div class="top-image">
      <img
        src="{{ url_for('static', filename='documents/Hibi_logo.png') }}"
        alt="ロゴ"
      />
    </div>
    {% if error %}
    <div class="error">{{ error }}</div>
    {% endif %}
    <form method="POST" action="{{ url_for('act_register') }}">
      <h1>新規登録</h1>
      <label for="name">お名前<span style="color: red">*</span></label>
      <input
        type="text"
        id="name"
        name="name"
        autocomplete="name"
        required
        value="{{ request.form.get('name', '') }}"
      />

      <label for="email">メールアドレス<span style="color: red">*</span></label>
      <input
        type="email"
        id="email"
        name="email"
        autocomplete="email"
        required
        value="{{ request.form.get('email', '') }}"
      />

      <label for="confirm_email"
        >メールアドレス（確認）<span style="color: red">*</span></label
      >
      <input
        type="email"
        id="confirm_email"
        name="confirm_email"
        required
        value="{{ request.form.get('confirm_email', '') }}"
      />

      <label>パスワード<span style="color: red">*</span></label>
      <div class="pass_box">
        <input
          type="password"
          id="password"
          name="password"
          required
          value="{{ request.form.get('password', '') }}"
        />
        <i class="fa-solid fa-eye"></i>
      </div>

      <label>パスワード（確認）<span style="color: red">*</span></label>
      <div class="pass_box">
        <input
          type="password"
          id="confirm_password"
          name="confirm_password"
          required
          value="{{ request.form.get('confirm_password', '') }}"
        />
        <i class="fa-solid fa-eye"></i>
      </div>
      <label>
        <input type="checkbox" id="terms" name="terms" value="agree" {% if
        request.form.get('terms') %}checked{% endif %} />
        <a
          href="{{ url_for('static', filename='documents/hibi_プライバシー.pdf') }}"
          target="_blank"
        >
          個人情報保護方針 </a
        >に同意する<span style="color: red">*</span>
      </label>

      <button type="submit">登録する</button>
    </form>
  </body>
</html>
<script>
  //  id="view"を取得
  let viewicon = document.getElementById("view");

  //  id="password"を取得
  let inputtype = document.getElementById("password");

  //  id="view"クリック時の処理を設定
  $("#view").on("click", function () {
    //  passwordからtextへ
    if (inputtype.type === "password") {
      inputtype.type = "text";
      viewicon.innerHTML = '<i class="far fa-eye"></i>';

      //  textからpasswordへ
    } else {
      inputtype.type = "password";
      viewicon.innerHTML = '<i class="far fa-eye-slash"></i>';
    }
  });
</script>
